<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template App</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    
     <!-- Link default.js file -->
     <!-- <script src="default.js"></script>
     <script src="script.js"></script> -->

</head>
<body>
    <nav>
        <div class="nav-wrapper">
          <a href="#" class="brand-logo">Logo</a>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="index.html">Home</a></li>
            <li class="active"><a href="page2.html">Page 2</a></li>
          </ul>
        </div>
      </nav>
        
      <main class="container"c>
        <h1 style="text-align: center;">Signup Form</h1>

 <!-- start of form        -->
        <div class="row">
          <form id="myForm" class="col s10" >
            <div class="row">
              <div class="input-field col s12">
                <input name="username" type="text" minlength="8" required>
                <label for="username">Username</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s12">
                <input name="password" type="password"  required pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z]).{8,}$">
                <label for="password">Password</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s12">
                <input name="email" type="email" required>
                <label for="email">Email</label>
              </div>
            </div>
                      
            <div class="row">
              <div class="col">
                <input type="submit" class="btn waves-effect waves-light blue" value="Sign Up" required/>

              </div>
            </div>
           
          </form>
        </div>

      </main>


    <script>
         M.AutoInit();
    </script>
    <script>

      // Need to fix!!
      const server = 'https://anime-userbase.herokuapp.com/nc/anime_userdb_5wjm/api/v1/Userdata';


      function getFormData(form){
          return Object.fromEntries(new FormData(form));
        }
      
          //the Event object is passed to any event handler called via an event attribute eg onclick, onsubmit etc
        function submit(event){
          event.preventDefault();//prevents page redirection
              
        //  //event target returns the element on which the event is fired upon ie event.target === myForm
        
            const data = getFormData(event.target);//convert form data to object
            postData(server, data);
          }
        
        //attach the submit function to the submit event of myForm    
        document.querySelector('#myForm').addEventListener('submit', submit);
      
      
      async function postData(url, data){
        try{
      
            let response = await fetch(
              url, 
              {
                method: 'POST',
                body: JSON.stringify(data),//convert data to JSON string
                headers: { 'Content-Type':'application/json' }// JSON data
              },
            );//1. Send http request and get response
            
            let result = await response.json();//2. Get message from response
            console.log(result);//3. Do something with the message
          
          }catch(error){
            console.log(error);//catch and log any errors
          }
      }
    </script>
    
</body>
</html>